

 📚 一、功能概述

### 1.1 功能简介
试卷生成功能允许用户从历史批改记录中自动提取相似题目，生成PDF格式的练习试卷，方便打印和练习。这是一个完整的前后端交互功能，涉及数据获取、UI展示、PDF下载等多个环节。

### 1.2 用户使用流程
1. 用户在首页点击"生成试卷"入口
2. 进入试卷生成界面，查看统计信息（历史记录数、可用题目数等）
3. 选择试卷题目数量（5/10/15/20题）
4. 可选择预览题目列表
5. 点击"生成PDF试卷"按钮
6. 系统生成PDF并弹出分享/保存对话框

 🏗️ 二、技术架构

### 2.1 整体架构图
```
┌─────────────────────────────────────────────────────────────┐
│                      前端 (React Native)                      │
├─────────────────────────────────────────────────────────────┤
│                                                               │
│  ┌────────────────────────────────────────────────────────┐ │
│  │  GeneratePaperScreen.tsx (试卷生成界面)                 │ │
│  │  - 统计信息展示                                          │ │
│  │  - 题目数量选择器                                        │ │
│  │  - 预览/生成按钮                                         │ │
│  └──────────────────┬─────────────────────────────────────┘ │
│                     │                                          │
│                     ↓                                          │
│  ┌────────────────────────────────────────────────────────┐ │
│  │  paperService.ts (试卷服务层)                           │ │
│  │  - getStatistics() - 获取统计信息                       │ │
│  │  - previewPaper() - 预览题目                            │ │
│  │  - generateAndDownloadPaper() - 生成并下载PDF          │ │
│  └──────────────────┬─────────────────────────────────────┘ │
│                     │                                          │
└─────────────────────┼─────────────────────────────────────────┘
                      │ HTTP请求
                      ↓
┌─────────────────────────────────────────────────────────────┐
│                      后端 (Flask + Python)                    │
├─────────────────────────────────────────────────────────────┤
│                                                               │
│  ┌────────────────────────────────────────────────────────┐ │
│  │  paper_endpoints.py (API路由)                           │ │
│  │  - GET  /api/paper/statistics - 获取统计              │ │
│  │  - POST /api/paper/preview - 预览题目                  │ │
│  │  - POST /api/paper/generate - 生成PDF                  │ │
│  │  - GET  /api/paper/health - 健康检查                   │ │
│  └──────────────────┬─────────────────────────────────────┘ │
│                     │                                          │
│                     ↓                                          │
│  ┌────────────────────────────────────────────────────────┐ │
│  │  paper_generator.py (PDF生成服务)                       │ │
│  │  - extract_similar_questions_from_history()            │ │
│  │  - generate_paper_pdf()                                 │ │
│  │  - 中文字体配置 (宋体/黑体)                            │ │
│  └────────────────────────────────────────────────────────┘ │
│                                                               │
└─────────────────────────────────────────────────────────────┘
```

### 2.2 核心文件结构

#### 前端文件
```
llmhomework_Frontend/
├── app/
│   ├── screens/
│   │   └── GeneratePaperScreen.tsx      # 试卷生成主界面
│   ├── services/
│   │   └── paperService.ts              # 试卷相关API服务
│   └── navigation/
│       └── NavigationTypes.ts           # 路由类型定义
```

#### 后端文件
```
llmhomework_Backend/
├── app/
│   ├── api/
│   │   └── paper_endpoints.py           # API路由端点
│   └── services/
│       └── paper_generator.py           # PDF生成核心逻辑
```

---

## 💻 三、前端实现详解

### 3.1 GeneratePaperScreen.tsx - 试卷生成界面

#### 文件位置
`llmhomework_Frontend/app/screens/GeneratePaperScreen.tsx` (共552行)

#### 主要功能模块

##### 3.1.1 状态管理
```typescript
const [loading, setLoading] = useState(true);          // 加载状态
const [generating, setGenerating] = useState(false);   // 生成中状态
const [statistics, setStatistics] = useState<PaperStatistics | null>(null); // 统计信息
const [preview, setPreview] = useState<PaperPreview | null>(null);          // 预览数据
const [selectedCount, setSelectedCount] = useState(10);                      // 选择的题目数量
```

##### 3.1.2 核心方法
- **loadStatistics()** - 加载统计信息
  - 调用 `paperService.getStatistics()`
  - 显示历史记录数、可用题目数、推荐数量

- **handlePreview()** - 预览试卷
  - 调用 `paperService.previewPaper()`
  - 展示题目列表（前3题 + 还有X题的提示）

- **handleGenerate()** - 生成并下载PDF
  - 调用 `paperService.generateAndDownloadPaper()`
  - 显示生成进度
  - 自动打开分享对话框

##### 3.1.3 UI组件布局
```
SafeAreaView
├── Header (标题栏)
│   ├── 返回按钮
│   ├── "生成试卷"标题
│   └── 占位元素（保持居中）
├── ScrollView
│   ├── InfoCard (功能说明卡片)
│   │   ├── 图标 📝
│   │   ├── 标题
│   │   └── 描述文字
│   ├── StatisticsCards (统计信息卡片组)
│   │   ├── 历史记录数
│   │   ├── 可用题目数
│   │   └── 推荐数量
│   ├── QuestionCountSelector (题目数量选择器)
│   │   └── [5题] [10题] [15题] [20题] 按钮组
│   ├── WarningCard (题目不足时显示)
│   ├── ActionButtons (操作按钮)
│   │   ├── 预览题目按钮
│   │   └── 生成PDF试卷按钮
│   └── PreviewContainer (预览内容 - 可选显示)
│       ├── 预览标题
│       ├── 题目统计
│       ├── 题目1-3
│       └── "...还有X道题目"
```

##### 3.1.4 样式设计特点
- 使用项目统一的设计系统（`designSystem.ts`）
- 颜色方案：`primaryColor`、`successColor`、`errorColor` 等
- 卡片式布局，阴影效果（`shadows.level1/level2`）
- 按钮状态：正常/选中/禁用三态
- 响应式间距（`spacing.sm/md/lg`）
- 圆角设计（`borderRadius.md/lg`）

### 3.2 paperService.ts - 试卷服务层

#### 文件位置
`llmhomework_Frontend/app/services/paperService.ts` (共265行)

#### 核心API方法

##### 3.2.1 getStatistics() - 获取统计信息
```typescript
async getStatistics(userId?: string): Promise<PaperStatistics>
```
- **请求方式**: GET
- **API端点**: `/api/paper/statistics`
- **返回数据**:
  ```typescript
  {
    total_records: number;           // 历史记录总数
    total_similar_questions: number; // 可用题目总数
    can_generate: boolean;           // 是否可以生成试卷
    recommended_count: number;       // 推荐生成数量
  }
  ```

##### 3.2.2 previewPaper() - 预览试卷
```typescript
async previewPaper(options: GeneratePaperOptions): Promise<PaperPreview>
```
- **请求方式**: POST
- **API端点**: `/api/paper/preview`
- **请求参数**:
  ```typescript
  {
    user_id?: string;
    max_questions: number;  // 要预览的题目数量
  }
  ```
- **返回数据**:
  ```typescript
  {
    questions: PaperQuestion[];  // 题目列表
    total_found: number;         // 找到的题目总数
    will_use: number;            // 将使用的题目数
    message: string;             // 提示信息
  }
  ```

##### 3.2.3 generateAndDownloadPaper() - 生成并下载PDF
```typescript
async generateAndDownloadPaper(options: GeneratePaperOptions): Promise<string>
```
- **请求方式**: POST
- **API端点**: `/api/paper/generate`
- **请求参数**:
  ```typescript
  {
    user_id?: string;
    max_questions: number;
    title: string;  // 试卷标题
  }
  ```
- **处理流程**:
  1. 使用 `fetch` API 发送POST请求
  2. 接收PDF的Blob数据
  3. 转换为Base64编码
  4. 使用 `expo-file-system` 写入本地文件
  5. 使用 `expo-sharing` 打开分享对话框
- **返回**: 本地文件URI

##### 3.2.4 技术细节
- **网络请求**: 使用 `axios` 和 `fetch` 混合（PDF下载用fetch）
- **超时设置**: 
  - 统计信息: 10秒
  - 预览: 15秒
  - 生成PDF: 无超时（大文件）
- **错误处理**: 三层错误处理机制
  1. 服务器返回错误 (`response.data.error`)
  2. 网络错误 (`request` 无响应)
  3. 其他未知错误

---

## 🔧 四、后端实现详解

### 4.1 paper_generator.py - PDF生成核心

#### 文件位置
`llmhomework_Backend/app/services/paper_generator.py` (共413行)

#### 核心功能

##### 4.1.1 中文字体配置
```python
# 字体配置
FONT_NAME = 'SimSun'      # 宋体 - 用于正文
FONT_BOLD_NAME = 'SimHei' # 黑体 - 用于标题

# 字体搜索路径（按优先级）
font_paths = [
    'C:/Windows/Fonts/simsun.ttc',              # Windows
    '/usr/share/fonts/truetype/simsun.ttc',     # Linux
    'llmhomework_Backend/fonts/simsun.ttc',     # 项目本地
]
```

**字体注册流程**:
1. 遍历字体路径查找字体文件
2. 使用 `pdfmetrics.registerFont()` 注册
3. 如果失败，记录警告但不中断程序
4. 最终回退到系统默认字体

##### 4.1.2 extract_similar_questions_from_history() - 题目提取
从历史记录中提取题目，支持多种数据格式：

**方法1**: 新格式 - `similar_questions` 字段
```json
{
  "similar_questions": [
    {"question": "题目内容", "type": "选择题"}
  ]
}
```

**方法2**: 嵌套格式 - `grading_result.similar_question`
```json
{
  "grading_result": {
    "grading_result": [
      {"similar_question": "题目内容", "type": "计算题"}
    ]
  }
}
```

**方法3**: 兼容旧格式 - 直接使用原题目
```json
{
  "grading_result": [
    {"question": "题目内容", "type": "填空题"}
  ]
}
```

**去重逻辑**: 基于题目内容字符串的 `set` 去重

##### 4.1.3 generate_paper_pdf() - PDF生成
使用 ReportLab 库生成专业PDF：

**PDF布局结构**:
```
┌─────────────────────────────────────┐
│         练习试卷（标题，18号黑体）      │
│                                     │
│ 生成时间：2024年XX月XX日 XX:XX      │
│ 姓名：__________  分数：__________   │
│ ─────────────────────────────────   │
│                                     │
│ 1. [题型]                           │
│    题目内容...（10号宋体）           │
│    题目内容第二行...                 │
│    ────────────────────             │
│    答：_________________________     │
│                                     │
│ 2. [题型]                           │
│    题目内容...                       │
│    ...                              │
│                                     │
│             第 1 页                  │
└─────────────────────────────────────┘
```

**技术参数**:
- 页面大小: A4 (210mm × 297mm)
- 页边距: 2cm
- 标题字号: 18号（黑体）
- 题号字号: 11号（黑体）
- 题目字号: 10号（宋体）
- 答案行字号: 9号（宋体）
- 行间距: 0.6cm

**自动换页逻辑**:
- 当剩余高度 < 5cm 时，题目换页
- 当剩余高度 < 3cm 时，题目内容行换页

##### 4.1.4 文本换行处理
```python
def _wrap_text(self, text: str, max_width_mm: float) -> List[str]:
    # 假设中文字符宽度约为 4mm，英文约为 2mm
    max_chars = int(max_width_mm / 4)  # 保守估计
    # 按字符数拆分文本...
```
 4.2 paper_endpoints.py - API端点

#### 文件位置
`llmhomework_Backend/app/api/paper_endpoints.py` (共324行)

#### API端点详解

##### 4.2.1 POST /api/paper/generate - 生成试卷
- **功能**: 生成PDF并返回文件流
- **参数验证**: 题目数量必须在1-50之间
- **处理流程**:
  1. 获取历史记录 (`get_records`)
  2. 调用 `generate_paper_from_history` 生成PDF
  3. 使用 `send_file` 返回PDF流
- **文件名格式**: `exam_paper_YYYYMMDD_HHMMSS.pdf`

##### 4.2.2 POST /api/paper/preview - 预览题目
- **功能**: 返回题目列表，不生成PDF
- **返回**: 题目数组 + 统计信息
- **用途**: 让用户在生成前查看将要包含的题目

##### 4.2.3 GET /api/paper/statistics - 统计信息
- **功能**: 返回历史记录和可用题目的统计
- **计算逻辑**:
  - `total_records`: 历史记录总数
  - `total_similar_questions`: 提取出的题目总数（最多100）
  - `can_generate`: 是否有题目可生成
  - `recommended_count`: 建议生成数量（min(total, 10)）

##### 4.2.4 GET /api/paper/health - 健康检查
- **功能**: 检查服务状态和字体支持
- **返回示例**:
  ```json
  {
    "status": "healthy",
    "service": "paper_generator",
    "font_support": "ok"  // 或 "warning - using default font"
  }
  ```

#### 错误处理机制
```python
try:
    # 业务逻辑
except ValueError as e:
    # 业务错误（题目不足等）- 400
    return jsonify({'error': str(e)}), 400
except Exception as e:
    # 系统错误 - 500
    return jsonify({'error': '服务器内部错误'}), 500
```

---

## 📦 五、依赖和配置

### 5.1 前端依赖
```json
{
  "expo-file-system": "^17.0.0",  // 文件系统访问
  "expo-sharing": "^12.0.0",      // 文件分享功能
  "axios": "^1.6.0",              // HTTP客户端
  "react-native": "^0.73.0"       // RN框架
}
```

### 5.2 后端依赖
```python
Flask==3.0.0          # Web框架
reportlab==4.0.0      # PDF生成库
```

### 5.3 中文字体安装

#### Windows系统
系统自带宋体，无需额外配置。

#### Linux系统
```bash
# 方法1: 安装文泉驿字体
sudo apt-get install fonts-wqy-zenhei

# 方法2: 安装MS核心字体
sudo apt-get install ttf-mscorefonts-installer

# 方法3: 手动安装
# 1. 下载 simsun.ttc
# 2. 放到 /usr/share/fonts/truetype/
# 3. 更新字体缓存
sudo fc-cache -fv
```

---

🎯 六、你的开发任务

### 任务1: 调整试卷的排版问题

#### 问题描述
当前生成的PDF试卷在排版上可能存在以下问题：
1. 题目内容过长时换行不够美观
2. 题目之间的间距可能不够均匀
3. 页面利用率可能不够合理
4. 答题空间可能不够充足

#### 具体要求
1. **优化题目换行逻辑**
   - 文件位置: `llmhomework_Backend/app/services/paper_generator.py`
   - 目标方法: `_wrap_text()` (第338-366行)
   - 改进点:
     - 当前按字符数粗略拆分，需要改进为按实际字符宽度计算
     - 支持英文单词不断行（遇到空格才换行）
     - 支持数学公式、特殊符号的智能换行

2. **调整题目间距和布局**
   - 文件位置: `paper_generator.py`
   - 目标方法: `generate_paper_pdf()` (第182-328行)
   - 改进点:
     - 调整题目之间的垂直间距（当前是0.5cm，可能需要优化）
     - 调整答题区域的高度（当前是1.5cm固定值）
     - 根据题目类型动态调整答题空间（选择题较小，计算题较大）

3. **优化页面布局**
   - 改进点:
     - 调整页边距（当前是2cm，考虑打印机边距）
     - 优化标题区域高度
     - 改善页脚位置

4. **改进自动换页逻辑**
   - 当前换页阈值:
     - 题目换页: 剩余高度 < 5cm
     - 内容行换页: 剩余高度 < 3cm
   - 改进目标:
     - 避免一道题的标题和内容分开在两页
     - 确保每道题完整性
     - 优化最后一页的内容分布

#### 参考代码位置
```python
# paper_generator.py 中的关键变量
self.page_width, self.page_height = A4  # 页面大小
self.margin = 2 * cm                     # 页边距
self.content_width = self.page_width - 2 * self.margin  # 内容宽度

# 题目布局相关的Y坐标调整
y -= 0.7 * cm  # 题号后的间距
y -= 0.6 * cm  # 每行题目内容的间距
y -= 1.5 * cm  # 答题区域的高度
y -= 0.5 * cm  # 题目之间的间距
```

#### 验证方法
1. 生成包含5题、10题、20题的不同试卷
2. 检查各种长度的题目的换行效果
3. 检查多页试卷的换页位置
4. 打印实际PDF查看效果

---

### 任务2: 调整字体问题，让所有特殊符号可以正常显示

#### 问题描述
当前PDF可能无法正确显示以下内容：
1. 数学符号：√、≈、≠、≤、≥、∞、∑、∫、π 等
2. 希腊字母：α、β、γ、θ、λ、μ、σ、Ω 等
3. 上下标：x²、x₁、CO₂ 等
4. 特殊字符：℃、°、™、©、® 等
5. 分数、根式等复杂数学表达式

#### 具体要求

##### 2.1 字体配置优化
文件位置: `paper_generator.py` 第26-84行

**当前字体配置**:
```python
FONT_NAME = 'SimSun'      # 宋体
FONT_BOLD_NAME = 'SimHei' # 黑体
```

**改进方案**:
1. **添加符号字体支持**
   - 注册支持数学符号的字体（如 Arial Unicode MS、宋体扩展版）
   - 配置字体回退机制（Font Fallback）

2. **字体路径扩展**
   - 添加更多系统字体路径
   - 支持自定义字体目录
   - 添加字体检测和验证逻辑

3. **字体测试**
   - 编写字体功能测试代码
   - 测试常见特殊符号是否能正常显示
   - 生成字体支持报告

##### 2.2 特殊符号处理
**方案A: Unicode规范化**
```python
import unicodedata

def normalize_text(text: str) -> str:
    """将文本规范化为NFC格式，确保Unicode字符正确"""
    return unicodedata.normalize('NFC', text)
```

**方案B: 字符替换**
对于不支持的符号，提供替代方案：
```python
SYMBOL_REPLACEMENTS = {
    '√': '[根号]',
    '∫': '[积分]',
    # ... 更多映射
}
```

**方案C: 数学公式图片化**（高级方案）
- 使用 matplotlib 或 PIL 将复杂数学公式渲染为图片
- 将图片嵌入PDF中
- 适用于复杂数学表达式

##### 2.3 测试和验证

**创建测试题目集**:
在后端创建测试脚本 `test_paper_symbols.py`:
```python
"""
测试各种特殊符号在PDF中的显示效果
"""
test_questions = [
    {
        "question": "计算：√2 + √3 ≈ ?",
        "type": "计算题"
    },
    {
        "question": "已知角度θ = 30°，求sinθ的值",
        "type": "计算题"
    },
    {
        "question": "CO₂的分子式中含有几个氧原子？",
        "type": "选择题"
    },
    {
        "question": "证明：x² + y² ≥ 2xy",
        "type": "证明题"
    },
    {
        "question": "计算积分：∫₀¹ x²dx",
        "type": "计算题"
    }
]

# 生成测试PDF
generator = PaperGenerator()
pdf = generator.generate_paper_pdf(test_questions, title="特殊符号测试试卷")
```

**验证清单**:
- [ ] 基本数学运算符（+、-、×、÷）
- [ ] 比较符号（=、≠、<、>、≤、≥、≈）
- [ ] 根号和指数（√、²、³）
- [ ] 希腊字母（α、β、γ、π、θ、Σ）
- [ ] 化学符号（CO₂、H₂O、上下标）
- [ ] 角度和温度（°、℃）
- [ ] 积分和求和（∫、∑）
- [ ] 特殊标点（…、—、·）

##### 2.4 前端配合工作（可选）
如果发现题目文本中的符号在传输过程中被破坏：

1. **检查编码问题**
   - 文件位置: `paperService.ts`
   - 确保 `Content-Type` 设置为 `application/json; charset=utf-8`

2. **文本预处理**
   - 在发送到后端前对特殊符号进行转义或编码

#### 参考资源
1. **ReportLab字体文档**: https://docs.reportlab.com/reportlab/userguide/ch3_fonts/
2. **Unicode字符表**: https://unicode-table.com/
3. **Python字体处理**: `fontTools` 库

---

## 📋 七、开发流程建议

### 7.1 环境准备
1. **安装开发环境**
   ```bash
   # 后端
   cd llmhomework_Backend
   pip install -r requirements.txt
   
   # 前端
   cd llmhomework_Frontend
   npm install
   ```

2. **启动项目**
   ```bash
   # 启动后端
   cd llmhomework_Backend
   python run.py
   
   # 启动前端
   cd llmhomework_Frontend
   npm start
   ```

3. **测试试卷生成功能**
   - 在手机或模拟器上打开应用
   - 先完成一些作业批改，积累历史记录
   - 进入"生成试卷"界面测试功能

### 7.2 开发步骤

#### 任务1的开发步骤
1. **了解现有代码** (1-2小时)
   - 阅读 `paper_generator.py` 的 `generate_paper_pdf` 方法
   - 运行代码生成几份测试PDF，观察问题

2. **分析和设计** (2-3小时)
   - 测量打印出的PDF，记录实际尺寸
   - 列出需要调整的参数清单
   - 设计更合理的布局方案

3. **实现改进** (4-6小时)
   - 修改 `_wrap_text` 方法，改进换行逻辑
   - 调整 `generate_paper_pdf` 中的间距参数
   - 优化换页判断条件

4. **测试验证** (2-3小时)
   - 生成各种题目数量的试卷
   - 测试长题目、短题目的显示效果
   - 打印实际PDF查看效果

5. **代码审查和优化** (1-2小时)
   - 代码注释完善
   - 参数可配置化（不要硬编码）
   - 提交代码

#### 任务2的开发步骤
1. **调研和测试** (2-3小时)
   - 研究 ReportLab 的字体机制
   - 创建符号测试集
   - 生成测试PDF，记录哪些符号无法显示

2. **字体配置** (3-4小时)
   - 查找和安装支持特殊符号的中文字体
   - 修改字体注册逻辑
   - 实现字体回退机制

3. **符号处理** (3-4小时)
   - 实现Unicode规范化
   - 对不支持的符号提供替代方案
   - 测试各种符号的显示效果

4. **综合测试** (2-3小时)
   - 使用包含各种符号的题目生成试卷
   - 在不同系统（Windows、Linux）上测试
   - 记录测试结果

5. **文档编写** (1-2小时)
   - 编写字体安装指南
   - 记录已支持和不支持的符号
   - 提供使用建议

### 7.3 时间规划建议
- **任务1**: 预计 10-16 小时
- **任务2**: 预计 11-16 小时
- **总计**: 3-4 天（每天工作6-8小时）

### 7.4 提交规范
```bash
# Git提交信息格式
git commit -m "feat(paper): 优化试卷排版，改进题目换行逻辑"
git commit -m "fix(paper): 修复特殊符号显示问题，添加字体回退"
git commit -m "test(paper): 添加特殊符号显示测试"
```

---

## 🔍 八、调试和测试技巧

### 8.1 后端调试

#### 日志查看
后端使用 Python `logging` 模块，关键日志：
```python
logger.info("📝 从历史记录中提取了 X 道题目")
logger.info("✅ PDF试卷生成成功")
logger.error("❌ 生成PDF失败: error")
```

查看日志位置：控制台输出

#### 生成测试PDF
创建测试脚本 `test_paper_local.py`:
```python
from app.services.paper_generator import PaperGenerator

generator = PaperGenerator()

# 测试题目
questions = [
    {"question": "这是一道非常非常非常非常非常非常非常非常非常非常非常非常非常长的题目，用于测试换行效果", "type": "填空题"},
    {"question": "计算：√2 + π ≈ ?", "type": "计算题"},
    # ... 更多测试题
]

# 生成PDF
pdf = generator.generate_paper_pdf(questions, title="测试试卷", output_path="test_output.pdf")
print("PDF已生成: test_output.pdf")
```

运行：
```bash
cd llmhomework_Backend
python test_paper_local.py
```

### 8.2 前端调试

#### React Native 调试
1. **开启调试菜单**
   - iOS模拟器: `Cmd + D`
   - Android模拟器: `Cmd + M` (Mac) 或 `Ctrl + M` (Windows)

2. **查看网络请求**
   - 选择 "Debug" 选项
   - 打开 Chrome DevTools
   - 查看 Network 标签页

#### 日志查看
前端使用 `console.log`:
```typescript
console.log('📊 获取统计信息成功:', statistics);
console.log('✅ PDF下载成功:', fileUri);
console.error('❌ 生成失败:', error);
```

查看日志：
- Expo开发工具界面
- 终端输出
- Chrome DevTools Console

#### 测试PDF下载
```typescript
// 在 GeneratePaperScreen.tsx 中添加测试按钮
const testDownload = async () => {
  try {
    const result = await paperService.generateAndDownloadPaper({
      maxQuestions: 5,
      title: '测试试卷'
    });
    console.log('测试成功:', result);
  } catch (error) {
    console.error('测试失败:', error);
  }
};
```

### 8.3 常见问题排查

#### 问题1: PDF中文显示为方框
**原因**: 字体未正确注册
**解决**:
```bash
# 检查字体文件是否存在
ls -la C:/Windows/Fonts/simsun.ttc

# 后端日志查看
# 应该看到: ✅ 成功注册中文字体: SimSun
```

#### 问题2: 前端无法下载PDF
**原因**: 文件权限或网络问题
**排查**:
1. 检查后端API是否正常返回
2. 查看前端网络请求是否成功
3. 检查文件系统权限
```typescript
console.log('FileSystem.documentDirectory:', FileSystem.documentDirectory);
```

#### 问题3: 题目提取为空
**原因**: 历史记录格式不匹配
**排查**:
```python
# 在 extract_similar_questions_from_history 中添加调试
logger.info(f"历史记录结构: {json.dumps(record, indent=2, ensure_ascii=False)}")
```

---

## 📚 九、学习资源

### 9.1 技术文档
- **ReportLab官方文档**: https://docs.reportlab.com/
- **React Native文档**: https://reactnative.dev/
- **Expo File System**: https://docs.expo.dev/versions/latest/sdk/filesystem/
- **Flask文档**: https://flask.palletsprojects.com/

### 9.2 相关技术栈
- **TypeScript**: 前端类型系统
- **Python**: 后端语言
- **PDF生成**: ReportLab库
- **文件操作**: Expo SDK

### 9.3 推荐阅读
1. 《PDF Reference 1.7》- PDF格式规范
2. ReportLab User Guide - PDF生成详解
3. Unicode标准文档 - 字符编码

---

## ✅ 十、验收标准

### 10.1 任务1验收标准
- [ ] 题目内容换行合理，无截断单词现象
- [ ] 题目之间间距均匀，视觉效果良好
- [ ] 答题区域大小合理，符合实际使用需求
- [ ] 多页试卷换页位置合理，无题目断裂
- [ ] 生成5、10、15、20题的试卷均正常
- [ ] 打印实际PDF，排版清晰美观

### 10.2 任务2验收标准
- [ ] 常见数学符号正确显示（至少90%）
- [ ] 希腊字母正确显示
- [ ] 上下标格式正确（或有合理替代）
- [ ] 化学式、物理公式显示正确
- [ ] Windows和Linux系统均可正常生成
- [ ] 提供不支持符号的替代方案
- [ ] 编写符号支持文档

### 10.3 代码质量标准
- [ ] 代码有清晰的注释（中文）
- [ ] 函数和变量命名规范
- [ ] 无明显性能问题
- [ ] 错误处理完善
- [ ] 遵循项目现有代码风格

---

## 📞 十一、获取帮助

### 11.1 遇到问题时
1. **先自己尝试解决**
   - 查看错误日志
   - 搜索相关文档
   - 测试不同场景

2. **记录问题**
   - 详细描述问题现象
   - 记录错误信息
   - 截图或保存日志

3. **寻求帮助**
   - 向学长/导师咨询
   - 查看相关GitHub Issues
   - 在团队群中讨论

### 11.2 代码审查
完成任务后，请提交代码供审查：
1. 确保代码可运行
2. 提供测试用例
3. 编写简短的改进说明
4. 附上测试效果截图


