{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "type": "object",
  "properties": {
    "task_id": {
      "type": "string",
      "description": "任务唯一ID"
    },
    "timestamp": {
      "type": "number",
      "description": "时间戳"
    },
    "user_id": {
      "type": ["string", "null"],
      "description": "用户ID"
    },
    "questions": {
      "type": "array",
      "items": {
        "type": "object",
        "properties": {
          "number": {
            "type": "string",
            "description": "题号"
          },
          "stem": {
            "type": "string",
            "description": "题目内容"
          },
          "answer": {
            "type": "string",
            "description": "学生答案"
          },
          "options": {
            "type": "object",
            "description": "选项"
          },
          "type": {
            "type": "string",
            "enum": ["选择题", "判断题", "填空题", "计算题", "应用题", "公式题", "口算题", "未知题型", "识别失败"],
            "description": "题目类型"
          },
          "question_id": {
            "type": "string",
            "description": "题目唯一ID"
          },
          "timestamp": {
            "type": "number",
            "description": "时间戳"
          },
          "subject": {
            "type": "string",
            "description": "学科分类"
          },
          "subject_code": {
            "type": "string",
            "description": "学科代码"
          },
          "classification_confidence": {
            "type": "number",
            "description": "分类置信度"
          },
          "classification_method": {
            "type": "string",
            "description": "分类方法"
          }
        },
        "required": ["number", "stem", "answer", "options", "type", "question_id", "timestamp"],
        "additionalProperties": true
      }
    },
    "grading_result": {
      "type": "array",
      "items": {
        "type": "object",
        "properties": {
          "question": {
            "type": "string",
            "description": "题目内容"
          },
          "answer": {
            "type": "string",
            "description": "学生答案"
          },
          "type": {
            "type": "string",
            "enum": ["选择题", "判断题", "填空题", "计算题", "应用题", "公式题", "口算题", "未知题型", "识别失败"],
            "description": "题目类型"
          },
          "correct": {
            "type": "boolean",
            "description": "是否正确"
          },
          "score": {
            "type": "number",
            "description": "得分"
          },
          "explanation": {
            "type": "string",
            "description": "批改说明"
          },
          "correct_answer": {
            "type": "string",
            "description": "正确答案"
          },
          "question_id": {
            "type": "string",
            "description": "题目ID"
          }
        },
        "required": ["question", "answer", "type", "correct", "score", "explanation", "question_id"],
        "additionalProperties": false
      }
    },
    "wrong_knowledges": {
      "type": "array",
      "items": {
        "type": "string"
      },
      "description": "错题知识点"
    },
    "summary": {
      "type": "object",
      "properties": {
        "total_questions": {
          "type": "number",
          "description": "总题数"
        },
        "correct_count": {
          "type": "number",
          "description": "正确题数"
        },
        "total_score": {
          "type": "number",
          "description": "总分"
        },
        "accuracy_rate": {
          "type": "number",
          "minimum": 0,
          "maximum": 1,
          "description": "正确率"
        }
      },
      "required": ["total_questions", "correct_count", "total_score", "accuracy_rate"],
      "additionalProperties": false
    },
    "ai_analysis": {
      "type": "object",
      "description": "AI分析结果（可选）",
      "properties": {
        "knowledge_analysis": {
          "type": "object",
          "description": "知识点分析",
          "properties": {
            "wrong_knowledge_points": {
              "type": "array",
              "items": {"type": "string"},
              "description": "错题知识点"
            },
            "improvement_suggestions": {
              "type": "array",
              "items": {"type": "string"},
              "description": "改进建议"
            },
            "performance_summary": {
              "type": "string",
              "description": "表现总结"
            }
          }
        },
        "practice_questions": {
          "type": "array",
          "items": {
            "type": "object",
            "properties": {
              "type": {"type": "string"},
              "stem": {"type": "string"},
              "options": {"type": "string"},
              "answer": {"type": "string"},
              "explanation": {"type": "string"}
            }
          },
          "description": "生成的练习题"
        },
        "multimodal_analysis": {
          "type": "object",
          "description": "多模态分析结果",
          "properties": {
            "analysis": {"type": "string"},
            "text_quality": {"type": "string"},
            "structure_detected": {"type": "object"}
          }
        }
      },
      "additionalProperties": false
    }
  },
  "required": ["task_id", "timestamp", "questions", "grading_result", "wrong_knowledges"],
  "additionalProperties": false
}
